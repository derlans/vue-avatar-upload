var ke=Object.defineProperty,ze=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var H=(e,m,x)=>m in e?ke(e,m,{enumerable:!0,configurable:!0,writable:!0,value:x}):e[m]=x,Y=(e,m)=>{for(var x in m||(m={}))Ie.call(m,x)&&H(e,x,m[x]);if(W)for(var x of W(m))$e.call(m,x)&&H(e,x,m[x]);return e},Z=(e,m)=>ze(e,be(m));(function(e,m){typeof exports=="object"&&typeof module!="undefined"?module.exports=m(require("vue")):typeof define=="function"&&define.amd?define(["vue"],m):(e=typeof globalThis!="undefined"?globalThis:e||self,e["vue-avatar-upload"]=m(e.Vue))})(this,function(e){"use strict";function m(n,t){const a=t.zoom||1,r=n.left-t.left>0?n.left-t.left:0,o=n.top-t.top>0?n.top-t.top:0,s=n.width,i=n.height;return{sx:r/a,sy:o/a,sw:s/a,sh:i/a}}function x(){const n=document.createElement("canvas"),t=n.getContext("2d");return function(r,o,s="png"){const{sx:i,sy:u,sw:c,sh:w}=o;return new Promise((p,f)=>{const v=new Image;v.crossOrigin="",v.src=r,v.onload=()=>{n.height=w,n.width=c,t.drawImage(v,i,u,c,w,0,0,c,w),n.toBlob(E=>{E&&p(E),f(new Error("canvas to blob error")),t.restore()},s)},v.onerror=E=>{f(E)}})}}function Q(n){return Math.sqrt(n.reduce((t,a)=>t+a**2,0))}function j(n,t){const a=Q(t);let r=0;return n.forEach((o,s)=>{r+=o*t[s]}),r/a}function G(n,t,a="POST",r){return new Promise((o,s)=>{const i=new XMLHttpRequest,u=r.headers||{};Object.keys(u).forEach(c=>{i.setRequestHeader(c,u[c])}),i.withCredentials=!!r.withCredentials,i.open(a,t),i.onload=()=>{i.status===200?o(i.response):s(new Error(i.statusText))},i.onerror=()=>{s(new Error("Network Error"))},i.send(n)})}function J(){return!!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function N(n,t,a,r){e.watch(n,()=>{n.value&&n.value.addEventListener(t,a,r)},{immediate:!0})}function L(n,t={stop:!1,preventDefault:!1}){var C;const a=(C=t.draggingBox)!=null?C:e.ref(document),{stop:r,preventDefault:o,range:s={}}=t,i=J(),u=e.ref(0),c=e.ref(0),w=e.ref(!1),p={x:0,y:0};function f(h){r&&h.stopPropagation(),o&&h.preventDefault()}const v=h=>{h.preventDefault()};function E(h){if(i){const S=h;p.x=S.touches[0].clientX,p.y=S.touches[0].clientY}else{const S=h;p.x=S.x,p.y=S.y}}const y=h=>{f(h),w.value=!0,E(h),i&&document.addEventListener("touchmove",v,{passive:!1})},_=h=>{var S,$,D,z;if(f(h),!!w.value){if(i){const V=h;u.value+=V.touches[0].clientX-p.x,c.value+=V.touches[0].clientY-p.y}else{const V=h;u.value+=V.x-p.x,c.value+=V.y-p.y}s&&(((S=s.x)==null?void 0:S.min)!==void 0&&u.value<s.x.min&&(u.value=s.x.min),(($=s.x)==null?void 0:$.max)!==void 0&&u.value>s.x.max&&(u.value=s.x.max),((D=s.y)==null?void 0:D.min)!==void 0&&c.value<s.y.min&&(c.value=s.y.min),((z=s.y)==null?void 0:z.max)!==void 0&&c.value>s.y.max&&(c.value=s.y.max)),E(h)}},B=h=>{f(h),i&&document.removeEventListener("touchmove",v),w.value=!1},I=e.computed(()=>({top:`${c.value}px`,left:`${u.value}px`}));return i?(N(n,"touchstart",y),N(a,"touchmove",_),N(a,"touchend",B)):(N(n,"mousedown",y),N(a,"mousemove",_),N(a,"mouseup",B)),{x:u,y:c,isDraging:w,style:I}}function K(n,t){const a=e.ref(0);function r(o){a.value+=o.deltaY>0?1:-1,t(o.deltaY>0?1:-1),o.preventDefault()}return N(n,"wheel",r),{wheel:a}}const X=.02;function ee(n,t){K(n,r);const a=e.ref(1);function r(p){a.value+=p>0?X:-X}const o=e.ref(0);function s(){o.value=(o.value+90)%360}const{style:i,x:u,y:c}=L(n,{stop:!0,preventDefault:!1}),w=e.computed(()=>Z(Y({},i.value),{width:`${t.width*a.value}px`,height:`${t.height*a.value}px`,transform:`rotate(${o.value}deg)`}));return{bgImgZoom:a,editPositionStyle:i,baImgX:u,baImgY:c,bgImgStyle:w,imgRotate:o,updateRotate:s}}function te(n,t,a,r){const o=e.ref(n),{x:s,y:i}=L(a,{stop:!0,preventDefault:!1}),u={x:{min:0,max:r.width-o.value},y:{min:0,max:r.height-o.value}};function c(){u.x.max=r.width-o.value,u.y.max=r.height-o.value}const{style:w,x:p,y:f}=L(t,{stop:!0,preventDefault:!1,range:u}),v=e.computed(()=>Y({width:`${o.value}px`,height:`${o.value}px`},w.value));function E(){o.value+p.value>r.width&&(o.value=r.width-p.value),o.value+f.value>r.height&&(o.value=r.height-f.value)}return e.watch([s,i],(y,_)=>{const B=y[0]-_[0],I=y[1]-_[1],C=j([B,I],[1,1]);o.value=o.value+C,o.value=o.value<=0?0:o.value,E(),c()}),{resizeX:s,resizeY:i,selectBoxSize:o,selectBoxStyle:v,selectPositionStyle:w,selectX:p,selectY:f}}var q={"zh-CN":{title:"\u7F16\u8F91\u5934\u50CF",changeAvatar:"\u66F4\u6362\u5934\u50CF",rotate:"\u65CB\u8F6C90\u5EA6",preview:"\u9884\u89C8",cancel:"\u53D6\u6D88",confirm:"\u786E\u5B9A"},"zh-TW":{title:"\u7DE8\u8F2F\u982D\u50CF",changeAvatar:"\u66F4\u63DB\u982D\u50CF",rotate:"\u65CB\u8F4990\u5EA6",preview:"\u9810\u89BD",cancel:"\u53D6\u6D88",confirm:"\u78BA\u5B9A"},en:{title:"Edit Avatar",changeAvatar:"Change Avatar",rotate:"Rotate 90\xB0",preview:"Preview",cancel:"Cancel",confirm:"Confirm"}},Me="",oe=(n,t)=>{const a=n.__vccOpts||n;for(const[r,o]of t)a[r]=o;return a};const R=n=>(e.pushScopeId("data-v-4e6f040d"),n=n(),e.popScopeId(),n),ne={class:"avatar-upload-header"},ae={key:0,class:"avatar-upload-title"},le={key:0,t:"1649489376154",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2215",width:"16",height:"16"},re=[R(()=>e.createElementVNode("path",{d:"M184.64768 836.34176c3.9936 3.9936 9.23648 5.98016 14.47936 5.98016 5.24288 0 10.48576-2.00704 14.49984-6.00064l292.70016-293.04832 292.70016 293.04832c3.9936 4.01408 9.23648 6.00064 14.49984 6.00064 5.24288 0 10.48576-2.00704 14.47936-5.98016 8.00768-7.9872 8.00768-20.95104 0.02048-28.95872L535.61344 514.64192 828.0064 221.92128c7.9872-8.00768 7.9872-20.97152-0.02048-28.95872-8.02816-8.00768-20.97152-8.00768-28.95872 0.02048L506.30656 486.03136 213.6064 192.98304c-8.00768-8.00768-20.97152-8.00768-28.95872-0.02048-8.00768 7.9872-8.00768 20.95104-0.02048 28.95872l292.37248 292.72064L184.6272 807.38304C176.64 815.37024 176.64 828.35456 184.64768 836.34176z",fill:"","p-id":"2216"},null,-1))],se={class:"avatar-upload-main"},ie=R(()=>e.createElementVNode("div",{class:"edit-fade"},null,-1)),ce={class:"edit-selcet-img-box"},de=["src"],ue=R(()=>e.createElementVNode("span",{class:"edit-selcet-border border-3-white"},null,-1)),fe=["src"],he={class:"avatar-upload-operation"},me=R(()=>e.createElementVNode("svg",{t:"1649489582570",class:"icon-rotate",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3047",width:"16",height:"16"},[e.createElementVNode("path",{d:"M503.466667 285.866667L405.333333 226.133333c-8.533333-8.533333-12.8-21.333333-8.533333-29.866666 8.533333-8.533333 21.333333-12.8 29.866667-8.533334l145.066666 89.6c8.533333 4.266667 12.8 17.066667 8.533334 29.866667l-89.6 145.066667c-4.266667 8.533333-17.066667 12.8-29.866667 8.533333-8.533333-4.266667-12.8-17.066667-8.533333-29.866667l64-102.4c-123.733333 4.266667-226.133333 106.666667-226.133334 234.666667s106.666667 234.666667 234.666667 234.666667c85.333333 0 162.133333-46.933333 204.8-119.466667 4.266667-8.533333 17.066667-12.8 29.866667-8.533333 8.533333 4.266667 12.8 17.066667 8.533333 29.866666-51.2 85.333333-140.8 140.8-238.933333 140.8-153.6 0-277.333333-123.733333-277.333334-277.333333 0-145.066667 110.933333-264.533333 251.733334-277.333333z","p-id":"3048"})],-1)),pe={key:0,class:"avatar-upload-preview"},ge=["src"],we=["src"],ve={class:"avatar-upload-actions"},ye={key:0,class:"avatar-button -regular"},xe={key:0,class:"avatar-button -salmon"},Ee=["name","accept"];var A=oe(e.defineComponent({props:{avatar:null,url:null,field:{default:"avatar"},format:{default:"png"},headers:null,data:null,width:{default:300},height:{default:300},selectSize:{default:300},withCredentials:{type:Boolean,default:!1},method:{default:"POST"},accept:{default:"image/*"},rotate:{type:Boolean,default:!0},fixed:{type:Boolean,default:!0},showPreview:{type:Boolean,default:!0},previewSize:{default:100},i18:null,lang:{default:"zh-CN"},onCustomRequest:null,onBefoureUpload:null,onSuccess:null,onError:null,onClose:null},setup(n){const t=n,a=t.i18||q[t.lang]||q["zh-CN"],r=e.useSlots(),o=e.ref(t.avatar||""),{width:s,height:i,selectSize:u,previewSize:c}=t,w=u<Math.min(t.width,t.height)?u:Math.min(t.width,t.height),p={width:`${s}px`,height:`${i}px`},f=e.reactive({width:s,height:i}),v=e.ref(null);e.watch(v,()=>{var d;(d=v.value)!=null&&d.width&&S()},{immediate:!0});const E=e.ref(null),{bgImgZoom:y,baImgX:_,baImgY:B,bgImgStyle:I,imgRotate:C,updateRotate:h}=ee(E,f);function S(){e.nextTick(()=>{const d=v.value;d.onload=()=>{const l=d.naturalWidth,g=d.naturalHeight;l/g>s/i?(y.value=i/g,f.height=g,f.width=l):(y.value=s/l,f.height=g,f.width=l),_.value=0,B.value=0}})}const $=e.ref(null),D=e.ref(null),{selectBoxSize:z,selectBoxStyle:V,selectX:P,selectY:O}=te(w,$,D,{width:s,height:i}),_e=e.computed(()=>({width:`${f.width*y.value}px`,height:`${f.height*y.value}px`,left:`${_.value-P.value}px`,top:`${B.value-O.value}px`,transform:`rotate(${C.value}deg)`})),T=e.computed(()=>({width:`${c}px`,height:`${c}px`})),F=e.computed(()=>{const d=c/z.value;return{width:`${f.width*d*y.value}px`,height:`${f.height*d*y.value}px`,left:`${(_.value-P.value)*d}px`,top:`${(B.value-O.value)*d}px`,transform:`rotate(${C.value}deg)`}}),U=e.ref(null);function Be(d){const l=d.target,g=new FileReader;g.onload=b=>{const k=b.target.result;k&&(o.value=k,S())},g.readAsDataURL(l.files[0])}async function Ne(){const d=new FormData,l=await Ve(),g=t.format;d.append(t.field,l);const b=new File([l],`avatar.${g}`,{type:`image/${g}`});if(t.onCustomRequest){await t.onCustomRequest(b);return}t.onBefoureUpload&&!await t.onBefoureUpload(b)||G(d,t.url,t.method,{headers:t.headers,data:t.data,withCredentials:t.withCredentials}).then(k=>{var M;(M=t.onSuccess)==null||M.call(t,b,k)}).catch(k=>{var M;(M=t==null?void 0:t.onError)==null||M.call(t,b,k)})}const Ce=x();function Ve(){const d=m({left:P.value,top:O.value,width:z.value,height:z.value},{left:_.value,top:B.value,width:f.width,height:f.height,zoom:y.value});return Ce(o.value,d,t.format)}return(d,l)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"avatar-upload-root":!0,"avatar-upload-root-fixed":t.fixed})},[e.createElementVNode("div",{class:e.normalizeClass({"avatar-upload-fade":t.fixed})},null,2),e.createElementVNode("div",{class:e.normalizeClass({"avatar-upload":!0,"avatar-upload-fixed":t.fixed})},[e.createElementVNode("div",ne,[e.unref(r).title?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",ae,e.toDisplayString(e.unref(a).title),1)),e.renderSlot(d.$slots,"title",{},void 0,!0),e.createElementVNode("div",{class:"avatar-upload-close",onClick:l[0]||(l[0]=(...g)=>t.onClose&&t.onClose(...g))},[e.renderSlot(d.$slots,"closeIcon",{},void 0,!0),e.unref(r).closeIcon?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("svg",le,re))])]),e.createElementVNode("div",se,[e.createElementVNode("div",null,[e.createElementVNode("div",{ref_key:"editBox",ref:E,class:"avatar-upload-edit",style:p},[ie,e.createElementVNode("div",{ref_key:"select",ref:$,class:"edit-select",style:e.normalizeStyle(e.unref(V))},[e.createElementVNode("span",ce,[e.createElementVNode("img",{src:o.value,alt:"",style:e.normalizeStyle(e.unref(_e)),class:"edit-select-img",onDragstart:l[1]||(l[1]=e.withModifiers(()=>{},["prevent"])),onSelect:l[2]||(l[2]=e.withModifiers(()=>{},["prevent"]))},null,44,de)]),ue,e.createElementVNode("span",{ref_key:"resize",ref:D,class:"select-zoom-point"},null,512)],4),e.createElementVNode("img",{ref_key:"bgAvatar",ref:v,src:o.value,alt:"",style:e.normalizeStyle(e.unref(I)),class:"edit-bg",onDragstart:l[3]||(l[3]=e.withModifiers(()=>{},["prevent"])),onSelect:l[4]||(l[4]=e.withModifiers(()=>{},["prevent"]))},null,44,fe)],512),e.createElementVNode("div",he,[e.createElementVNode("span",{style:{cursor:"pointer"},onClick:l[5]||(l[5]=g=>U.value.click())},e.toDisplayString(e.unref(a).changeAvatar),1),e.createElementVNode("span",{style:{cursor:"pointer"},class:"upload-operation-close",onClick:l[6]||(l[6]=(...g)=>e.unref(h)&&e.unref(h)(...g))},[t.rotate?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[me,e.createElementVNode("span",null,e.toDisplayString(e.unref(a).rotate),1)],64)):e.createCommentVNode("",!0)])])]),t.showPreview?(e.openBlock(),e.createElementBlock("div",pe,[e.createElementVNode("span",null,e.toDisplayString(e.unref(a).preview),1),e.createElementVNode("div",{class:"preview-radius border-3-white",style:e.normalizeStyle(e.unref(T))},[e.createElementVNode("img",{src:o.value,alt:"",style:e.normalizeStyle(e.unref(F)),onDragstart:l[7]||(l[7]=e.withModifiers(()=>{},["prevent"])),onSelect:l[8]||(l[8]=e.withModifiers(()=>{},["prevent"]))},null,44,ge)],4),e.createElementVNode("div",{class:"preview-square border-3-white",style:e.normalizeStyle(e.unref(T))},[e.createElementVNode("img",{src:o.value,alt:"",style:e.normalizeStyle(e.unref(F)),onDragstart:l[9]||(l[9]=e.withModifiers(()=>{},["prevent"])),onSelect:l[10]||(l[10]=e.withModifiers(()=>{},["prevent"]))},null,44,we)],4)])):e.createCommentVNode("",!0)]),e.createElementVNode("div",ve,[e.createElementVNode("div",{onClick:l[11]||(l[11]=(...g)=>t.onClose&&t.onClose(...g))},[e.unref(r).cancel?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",ye,e.toDisplayString(e.unref(a).cancel),1)),e.renderSlot(d.$slots,"cancel",{},void 0,!0)]),e.createElementVNode("div",{onClick:Ne},[e.unref(r).confirm?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",xe,e.toDisplayString(e.unref(a).confirm),1)),e.renderSlot(d.$slots,"confirm",{},void 0,!0)])]),e.withDirectives(e.createElementVNode("div",null,[e.createElementVNode("input",{ref_key:"file",ref:U,type:"file",name:t.field,accept:t.accept,onInput:Be},null,40,Ee)],512),[[e.vShow,!1]])],2)],2))}}),[["__scopeId","data-v-4e6f040d"]]);const Se="VueAvatarUpload";return A.install=function(n){n.component(Se,A)},A});
